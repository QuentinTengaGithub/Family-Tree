{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport interact from 'interactjs';\nimport html2canvas from 'html2canvas';\nimport FiltersSidePanel from '../components/FiltersSidePanel.vue';\nexport default {\n  data() {\n    return {\n      processedGenerations: [],\n      allMemberBoxes: {},\n      zoomLevel: 1,\n      showScreenshotOptions: false,\n      showEmailInput: false,\n      email: '',\n      isFiltersPanelVisible: false,\n      selectedGender: '',\n      // To store the filter value\n      selectedRelationship: '',\n      isPanning: false,\n      panStart: {\n        x: 0,\n        y: 0\n      },\n      treePosition: {\n        x: 0,\n        y: 0\n      }\n    };\n  },\n  computed: {\n    members() {\n      return this.$store.state.members;\n    },\n    filteredMembers() {\n      if (!this.selectedGender) {\n        return this.members;\n      }\n      return this.members.filter(member => member.gender === this.selectedGender);\n    },\n    darkMode() {\n      return this.$store.state.darkMode;\n    },\n    displayGenerations() {\n      if (!this.selectedRelationship) {\n        return this.processedGenerations;\n      }\n      const filteredGenerations = [];\n      for (const generation of this.processedGenerations) {\n        const filteredGroups = generation.filter(group => {\n          if (this.selectedRelationship === 'married') {\n            return group.type === 'couple';\n          }\n          return true;\n        });\n        if (filteredGroups.length > 0) {\n          filteredGenerations.push(filteredGroups);\n        }\n      }\n      return filteredGenerations;\n    }\n  },\n  components: {\n    FiltersSidePanel\n  },\n  watch: {\n    members: {\n      handler: 'renderTree',\n      deep: true\n    },\n    zoomLevel() {\n      // Wait for the 0.3s zoom transition to finish before redrawing lines\n      setTimeout(() => {\n        this.drawRelationships();\n      }, 300);\n    }\n  },\n  mounted() {\n    window.addEventListener('resize', this.renderTree);\n    this.renderTree();\n    this.initInteract();\n  },\n  beforeUnmount() {\n    window.removeEventListener('resize', this.renderTree);\n  },\n  methods: {\n    startPan(event) {\n      if (event.target.closest('.draggable-group')) {\n        return;\n      }\n      this.isPanning = true;\n      this.panStart.x = event.clientX;\n      this.panStart.y = event.clientY;\n    },\n    pan(event) {\n      if (this.isPanning) {\n        const dx = event.clientX - this.panStart.x;\n        const dy = event.clientY - this.panStart.y;\n        this.treePosition.x += dx;\n        this.treePosition.y += dy;\n        this.panStart.x = event.clientX;\n        this.panStart.y = event.clientY;\n      }\n    },\n    endPan() {\n      this.isPanning = false;\n    },\n    toggleFiltersPanel() {\n      this.isFiltersPanelVisible = !this.isFiltersPanelVisible;\n    },\n    closeFiltersPanel() {\n      this.isFiltersPanelVisible = false;\n    },\n    applyGenderFilter(gender) {\n      this.selectedGender = gender;\n      this.renderTree(); // Re-render the tree with the new filter\n    },\n\n    applyRelationshipFilter(relationship) {\n      this.selectedRelationship = relationship;\n      this.renderTree(); // Re-render the tree with the new filter\n    },\n\n    openScreenshotOptions() {\n      this.showScreenshotOptions = true;\n      this.showEmailInput = false;\n      this.email = '';\n    },\n    downloadScreenshot() {\n      const captureTarget = this.$refs.treeWrapper;\n      if (!captureTarget) return;\n      html2canvas(captureTarget, {\n        useCORS: true,\n        allowTaint: true,\n        width: captureTarget.scrollWidth,\n        height: captureTarget.scrollHeight,\n        backgroundColor: 'white'\n      }).then(canvas => {\n        const link = document.createElement('a');\n        link.href = canvas.toDataURL('image/png');\n        link.download = 'family-tree.png';\n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n        this.showScreenshotOptions = false;\n      });\n    },\n    sendEmail() {\n      const captureTarget = this.$refs.treeWrapper;\n      if (!captureTarget) return;\n      if (!this.email) {\n        alert('Please enter an email address.');\n        return;\n      }\n      html2canvas(captureTarget, {\n        useCORS: true,\n        allowTaint: true,\n        width: captureTarget.scrollWidth,\n        height: captureTarget.scrollHeight,\n        backgroundColor: 'white'\n      }).then(canvas => {\n        const image = canvas.toDataURL('image/png');\n        fetch('http://localhost:3000/send-email', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            email: this.email,\n            image: image\n          })\n        }).then(response => response.text()).then(data => {\n          alert(data);\n          this.showScreenshotOptions = false;\n        }).catch(error => {\n          console.error('Error:', error);\n          alert('Error sending email. Make sure the backend server is running.');\n        });\n      });\n    },\n    renderTree() {\n      this.allMemberBoxes = {};\n      this.processMembers();\n      this.optimizeCoupleOrder();\n      this.$nextTick(() => {\n        this.drawRelationships();\n      });\n    },\n    initInteract() {\n      interact('.draggable-group').draggable({\n        inertia: true,\n        autoScroll: true,\n        listeners: {\n          move: this.dragMoveListener,\n          end: this.dragEndListener\n        }\n      });\n    },\n    dragMoveListener(event) {\n      const target = event.target;\n      const groupId = target.getAttribute('data-group-id');\n\n      // Find the group in the processedGenerations data\n      let group = null;\n      for (const generation of this.processedGenerations) {\n        group = generation.find(g => g.id === groupId);\n        if (group) break;\n      }\n      if (group) {\n        // The drag event's dx/dy are scaled by the zoom, we need to un-scale them\n        const unscaledDx = event.dx / this.zoomLevel;\n        const unscaledDy = event.dy / this.zoomLevel;\n        const x = (group.x || 0) + unscaledDx;\n        const y = (group.y || 0) + unscaledDy;\n        group.x = x;\n        group.y = y;\n        target.style.transform = `translate(${x}px, ${y}px)`;\n        target.setAttribute('data-x', x);\n        target.setAttribute('data-y', y);\n        this.drawRelationships();\n      }\n    },\n    dragEndListener(event) {\n      const target = event.target;\n      const groupId = target.getAttribute('data-group-id');\n      const x = parseFloat(target.getAttribute('data-x')) || 0;\n      const y = parseFloat(target.getAttribute('data-y')) || 0;\n      this.saveGroupPosition(groupId, x, y);\n    },\n    saveGroupPosition(groupId, x, y) {\n      localStorage.setItem(`group-pos-${groupId}`, JSON.stringify({\n        x,\n        y\n      }));\n    },\n    loadGroupPosition(groupId) {\n      const pos = localStorage.getItem(`group-pos-${groupId}`);\n      if (pos) {\n        return JSON.parse(pos);\n      }\n      return {\n        x: 0,\n        y: 0\n      };\n    },\n    optimizeCoupleOrder() {\n      this.processedGenerations.forEach(generation => {\n        for (let k = 0; k < generation.length; k++) {\n          for (let i = 0; i < generation.length - 1; i++) {\n            const groupA = generation[i];\n            const groupB = generation[i + 1];\n            if (groupA.type === 'couple' && groupB.type === 'couple') {\n              const [memberA1] = groupA.members;\n              const [, memberB2] = groupB.members;\n              const groupBMembers = new Set(groupB.members.map(m => m.name));\n              const groupAMembers = new Set(groupA.members.map(m => m.name));\n              if (memberA1.siblings && memberA1.siblings.some(s => groupBMembers.has(s))) {\n                [groupA.members[0], groupA.members[1]] = [groupA.members[1], groupA.members[0]];\n              }\n              if (memberB2.siblings && memberB2.siblings.some(s => groupAMembers.has(s))) {\n                [groupB.members[0], groupB.members[1]] = [groupB.members[1], groupB.members[0]];\n              }\n            }\n          }\n        }\n      });\n    },\n    processMembers() {\n      const members = this.filteredMembers;\n      if (members.length === 0) {\n        this.processedGenerations = [];\n        return;\n      }\n      const memberMap = new Map(members.map(m => [m.name, m]));\n      const generations = new Map();\n      const visited = new Set();\n      const roots = members.filter(m => !members.some(p => (p.children || []).includes(m.name)));\n      function assignGeneration(memberName, generation) {\n        if (visited.has(memberName) || !memberMap.has(memberName)) return;\n        visited.add(memberName);\n        if (!generations.has(generation)) {\n          generations.set(generation, new Set());\n        }\n        generations.get(generation).add(memberName);\n        const member = memberMap.get(memberName);\n        (member.children || []).forEach(childName => {\n          assignGeneration(childName, generation + 1);\n        });\n      }\n      roots.forEach(root => assignGeneration(root.name, 0));\n      const finalGenerations = [];\n      const sortedGenerationKeys = [...generations.keys()].sort((a, b) => a - b);\n      sortedGenerationKeys.forEach(genKey => {\n        const generationMembers = [...generations.get(genKey)].map(name => memberMap.get(name));\n        const finalProcessed = [];\n        const processedNames = new Set();\n        const processGroup = (id, type, members) => {\n          const pos = this.loadGroupPosition(id);\n          finalProcessed.push({\n            id,\n            type,\n            members,\n            ...pos\n          });\n          members.forEach(m => processedNames.add(m.name));\n        };\n        if (this.selectedRelationship === 'siblings') {\n          generationMembers.forEach(member => {\n            if (processedNames.has(member.name)) return;\n            if (member.siblings && member.siblings.length > 0) {\n              const siblingGroupMembers = [member, ...member.siblings.map(name => generationMembers.find(m => m.name === name)).filter(Boolean)];\n              if (siblingGroupMembers.length > 1) {\n                // Check if any member of this potential group has already been processed.\n                const alreadyProcessed = siblingGroupMembers.some(m => processedNames.has(m.name));\n                if (!alreadyProcessed) {\n                  const groupId = siblingGroupMembers.map(m => m.name).sort().join('-');\n                  processGroup(groupId, 'siblings', siblingGroupMembers);\n                }\n              }\n            }\n          });\n        } else {\n          // Existing logic\n          generationMembers.forEach(member => {\n            if (processedNames.has(member.name)) return;\n            if (member.married) {\n              const partner = generationMembers.find(m => m.name === member.married);\n              if (partner && !processedNames.has(partner.name)) {\n                const coupleMembers = [member, partner].sort((a, b) => b.age - a.age);\n                processGroup(`${member.name}-${partner.name}`, 'couple', coupleMembers);\n              }\n            }\n          });\n          generationMembers.forEach(member => {\n            if (processedNames.has(member.name)) return;\n            if (member.siblings && member.siblings.length > 0) {\n              const siblingGroup = [member, ...member.siblings.map(name => generationMembers.find(m => m.name === name)).filter(Boolean)];\n              if (siblingGroup.length > 1 && siblingGroup.every(m => !processedNames.has(m.name))) {\n                // Instead of grouping siblings, treat them as singles for individual dragging\n                siblingGroup.forEach(sibling => {\n                  if (!processedNames.has(sibling.name)) {\n                    processGroup(sibling.name, 'single', [sibling]);\n                  }\n                });\n              }\n            }\n          });\n          generationMembers.forEach(member => {\n            if (!processedNames.has(member.name)) {\n              processGroup(member.name, 'single', [member]);\n            }\n          });\n        }\n        finalGenerations.push(finalProcessed);\n      });\n      this.processedGenerations = finalGenerations;\n    },\n    drawRelationships() {\n      const svg = this.$refs.svgContainer;\n      const wrapper = this.$refs.transformContainer;\n      if (!svg || !wrapper) return;\n      svg.innerHTML = '';\n      wrapper.querySelectorAll('.html-heart').forEach(h => h.remove());\n      const wrapperRect = wrapper.getBoundingClientRect();\n      const drawnChildren = new Set();\n      const relationship = this.selectedRelationship;\n      if (relationship === '' || relationship === 'married') {\n        this.filteredMembers.forEach(member => {\n          if (member.married && member.name < member.married) {\n            const partner = this.members.find(m => m.name === member.married);\n            if (!partner) return;\n            const memberBox = this.allMemberBoxes[member.name];\n            const partnerBox = this.allMemberBoxes[partner.name];\n            if (!memberBox || !partnerBox) return;\n            this.drawHeart(wrapper, wrapperRect, memberBox, partnerBox);\n            if (relationship === '') {\n              const commonChildren = this.getCommonChildren(member, partner);\n              commonChildren.forEach(childName => {\n                const childBox = this.allMemberBoxes[childName];\n                if (childBox) {\n                  const heartMidpoint = this.getHeartMidpoint(wrapperRect, memberBox, partnerBox);\n                  this.drawPathFromPoint(svg, wrapperRect, heartMidpoint, childBox, 'blue');\n                  drawnChildren.add(childName);\n                }\n              });\n            }\n          }\n        });\n      }\n      if (relationship === '') {\n        this.filteredMembers.forEach(member => {\n          if (member.siblings) {\n            member.siblings.forEach(siblingName => {\n              if (member.name < siblingName) {\n                const siblingBox = this.allMemberBoxes[siblingName];\n                if (siblingBox) this.drawPath(svg, wrapperRect, this.allMemberBoxes[member.name], siblingBox, 'green');\n              }\n            });\n          }\n        });\n      }\n      if (relationship === '') {\n        this.filteredMembers.forEach(member => {\n          if (member.children) {\n            member.children.forEach(childName => {\n              if (!drawnChildren.has(childName)) {\n                const childBox = this.allMemberBoxes[childName];\n                if (childBox) this.drawPath(svg, wrapperRect, this.allMemberBoxes[member.name], childBox, 'blue');\n              }\n            });\n          }\n        });\n      }\n    },\n    getCommonChildren(member1, member2) {\n      const children1 = new Set(member1.children || []);\n      const children2 = new Set(member2.children || []);\n      return [...children1].filter(childName => children2.has(childName));\n    },\n    getBoxCenter(wrapperRect, box) {\n      if (!box) return {\n        x: 0,\n        y: 0\n      };\n      const boxRect = box.getBoundingClientRect();\n      const x = boxRect.left + boxRect.width / 2 - wrapperRect.left;\n      const y = boxRect.top + boxRect.height / 2 - wrapperRect.top;\n      return {\n        x: x / this.zoomLevel,\n        y: y / this.zoomLevel\n      };\n    },\n    getHeartMidpoint(wrapperRect, box1, box2) {\n      const center1 = this.getBoxCenter(wrapperRect, box1);\n      const center2 = this.getBoxCenter(wrapperRect, box2);\n      return {\n        x: (center1.x + center2.x) / 2,\n        y: (center1.y + center2.y) / 2\n      };\n    },\n    drawALine(svg, p1, p2, color) {\n      const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n      path.setAttribute('d', `M ${p1.x} ${p1.y} L ${p2.x} ${p2.y}`);\n      path.setAttribute('stroke', color);\n      path.setAttribute('stroke-width', '2');\n      path.setAttribute('fill', 'none');\n      svg.appendChild(path);\n    },\n    drawPathFromPoint(svg, wrapperRect, startPoint, endBox, color) {\n      const endPoint = this.getBoxCenter(wrapperRect, endBox);\n      this.drawALine(svg, startPoint, endPoint, color);\n    },\n    drawPath(svg, wrapperRect, box1, box2, color) {\n      const startPoint = this.getBoxCenter(wrapperRect, box1);\n      const endPoint = this.getBoxCenter(wrapperRect, box2);\n      this.drawALine(svg, startPoint, endPoint, color);\n    },\n    drawHeart(container, wrapperRect, box1, box2) {\n      const midPoint = this.getHeartMidpoint(wrapperRect, box1, box2);\n      const heart = document.createElement('img');\n      heart.src = require('../assets/red_heart.png');\n      heart.className = 'heart-icon html-heart';\n      heart.style.position = 'absolute';\n      heart.style.left = `${midPoint.x - 12.5}px`;\n      heart.style.top = `${midPoint.y - 12.5}px`;\n      container.appendChild(heart);\n    },\n    formatBirthday(birthday) {\n      if (!birthday) return null;\n      const date = new Date(birthday);\n      if (isNaN(date)) return null;\n      const day = String(date.getDate()).padStart(2, '0');\n      const month = String(date.getMonth() + 1).padStart(2, '0');\n      const year = date.getFullYear();\n      return `${day}/${month}/${year}`;\n    },\n    zoomIn() {\n      this.zoomLevel = Math.min(this.zoomLevel + 0.2, 3);\n    },\n    zoomOut() {\n      this.zoomLevel = Math.max(this.zoomLevel - 0.2, 0.2);\n    }\n  }\n};","map":{"version":3,"names":["interact","html2canvas","FiltersSidePanel","data","processedGenerations","allMemberBoxes","zoomLevel","showScreenshotOptions","showEmailInput","email","isFiltersPanelVisible","selectedGender","selectedRelationship","isPanning","panStart","x","y","treePosition","computed","members","$store","state","filteredMembers","filter","member","gender","darkMode","displayGenerations","filteredGenerations","generation","filteredGroups","group","type","length","push","components","watch","handler","deep","setTimeout","drawRelationships","mounted","window","addEventListener","renderTree","initInteract","beforeUnmount","removeEventListener","methods","startPan","event","target","closest","clientX","clientY","pan","dx","dy","endPan","toggleFiltersPanel","closeFiltersPanel","applyGenderFilter","applyRelationshipFilter","relationship","openScreenshotOptions","downloadScreenshot","captureTarget","$refs","treeWrapper","useCORS","allowTaint","width","scrollWidth","height","scrollHeight","backgroundColor","then","canvas","link","document","createElement","href","toDataURL","download","body","appendChild","click","removeChild","sendEmail","alert","image","fetch","method","headers","JSON","stringify","response","text","catch","error","console","processMembers","optimizeCoupleOrder","$nextTick","draggable","inertia","autoScroll","listeners","move","dragMoveListener","end","dragEndListener","groupId","getAttribute","find","g","id","unscaledDx","unscaledDy","style","transform","setAttribute","parseFloat","saveGroupPosition","localStorage","setItem","loadGroupPosition","pos","getItem","parse","forEach","k","i","groupA","groupB","memberA1","memberB2","groupBMembers","Set","map","m","name","groupAMembers","siblings","some","s","has","memberMap","Map","generations","visited","roots","p","children","includes","assignGeneration","memberName","add","set","get","childName","root","finalGenerations","sortedGenerationKeys","keys","sort","a","b","genKey","generationMembers","finalProcessed","processedNames","processGroup","siblingGroupMembers","Boolean","alreadyProcessed","join","married","partner","coupleMembers","age","siblingGroup","every","sibling","svg","svgContainer","wrapper","transformContainer","innerHTML","querySelectorAll","h","remove","wrapperRect","getBoundingClientRect","drawnChildren","memberBox","partnerBox","drawHeart","commonChildren","getCommonChildren","childBox","heartMidpoint","getHeartMidpoint","drawPathFromPoint","siblingName","siblingBox","drawPath","member1","member2","children1","children2","getBoxCenter","box","boxRect","left","top","box1","box2","center1","center2","drawALine","p1","p2","color","path","createElementNS","startPoint","endBox","endPoint","container","midPoint","heart","src","require","className","position","formatBirthday","birthday","date","Date","isNaN","day","String","getDate","padStart","month","getMonth","year","getFullYear","zoomIn","Math","min","zoomOut","max"],"sources":["/Users/quentin/Family-Tree/src/views/MemberTree.vue"],"sourcesContent":["<template>\n    <div class=\"content\">\n        <p class=\"title\">Family tree</p>\n        <div \n            class=\"tree-wrapper\" \n            ref=\"treeWrapper\" \n            v-if=\"members.length > 0\"\n            @mousedown=\"startPan\"\n            @mousemove=\"pan\"\n            @mouseup=\"endPan\"\n            @mouseleave=\"endPan\"\n            :class=\"{ panning: isPanning }\"\n        >\n            <div \n              ref=\"transformContainer\"\n              class=\"transform-container\"\n              :style=\"{ transform: `scale(${zoomLevel}) translate(${treePosition.x}px, ${treePosition.y}px)`, transformOrigin: 'top center' }\"\n            >\n              <div \n                class=\"all_the_members\" \n                ref=\"container\" \n              >\n              <!-- Generational Layout -->\n              <div v-for=\"(generation, index) in displayGenerations\" :key=\"index\" class=\"generation\">\n                  <div v-for=\"group in generation\" :key=\"group.id\" class=\"member-group\" \n                    :class=\"['draggable-group', group.type + '-group']\"\n                    :style=\"{ transform: 'translate(' + group.x + 'px, ' + group.y + 'px)' }\"\n                    :data-group-id=\"group.id\"\n                    :data-x=\"group.x\" :data-y=\"group.y\">\n\n                      <!-- Couple Group -->\n                      <div v-if=\"group.type === 'couple'\" class=\"couple-box\" :class=\"{ 'highlight-married': selectedRelationship === 'married' }\">\n                          <div class=\"member_box\"\n                              :class=\"{ 'male-border': group.members[0].gender === 'male', 'female-border': group.members[0].gender === 'female', dark: darkMode }\"\n                              :ref=\"el => { if (el) allMemberBoxes[group.members[0].name] = el }\">\n                              <img style=\"width:70px\" v-if=\"group.members[0].gender === 'male' && group.members[0].image === null\" src=\"../assets/avatar_male.png\">\n                              <img style=\"width:70px\" v-if=\"group.members[0].gender === 'female' && group.members[0].image === null\" src=\"../assets/avatar_female.png\">\n                              <img style=\"width:70px\" v-if=\"group.members[0].image !== null\" :src=\"group.members[0].image\"><br>\n                              <span style=\"font-weight: bold\">{{ group.members[0].name }}</span><br>\n                              <span v-if=\"group.members[0].birthday !== ''\">{{ group.members[0].age }} ans</span><br>\n                              <span class=\"birthday\" v-if=\"group.members[0].birthday !== ''\">\n                                <img src=\"../assets/cake_dark.png\" v-if=\"this.darkMode === true\" style=\"width:14px\"/> \n                                <img src=\"../assets/cake.png\" v-if=\"this.darkMode === false\" style=\"width:14px\"/>\n                                ({{ formatBirthday(group.members[0].birthday) }})\n                              </span>\n                          </div>\n                          <div class=\"member_box\"\n                              :class=\"{ 'male-border': group.members[1].gender === 'male', 'female-border': group.members[1].gender === 'female', dark: darkMode }\"\n                              :ref=\"el => { if (el) allMemberBoxes[group.members[1].name] = el }\">\n                              <img style=\"width:70px\" v-if=\"group.members[1].gender === 'male' && group.members[1].image === null\" src=\"../assets/avatar_male.png\">\n                              <img style=\"width:70px\" v-if=\"group.members[1].gender === 'female' && group.members[1].image === null\" src=\"../assets/avatar_female.png\">\n                              <img style=\"width:70px\" v-if=\"group.members[1].image !== null\" :src=\"group.members[1].image\"><br>\n                              <span style=\"font-weight: bold\">{{ group.members[1].name }}</span><br>\n                              <span v-if=\"group.members[1].birthday !== ''\">{{ group.members[1].age }} ans</span><br>\n                              <span class=\"birthday\" v-if=\"group.members[1].birthday !== ''\">\n                                <img src=\"../assets/cake_dark.png\" v-if=\"this.darkMode === true\" style=\"width:14px\"/> \n                                <img src=\"../assets/cake.png\" v-if=\"this.darkMode === false\" style=\"width:14px\"/>\n                                ({{ formatBirthday(group.members[1].birthday) }})\n                              </span>\n                          </div>\n                      </div>\n\n                      <!-- Sibling Group -->\n                      <div v-else-if=\"group.type === 'siblings'\" class=\"sibling-box\">\n                          <div v-for=\"member in group.members\" :key=\"member.name\" class=\"member_box\"\n                              :class=\"{ 'male-border': member.gender === 'male', 'female-border': member.gender === 'female', dark: darkMode }\"\n                              :ref=\"el => { if (el) allMemberBoxes[member.name] = el }\">\n                              <img style=\"width:70px\" v-if=\"member.gender === 'male' && member.image === null\" src=\"../assets/avatar_male.png\">\n                              <img style=\"width:70px\" v-if=\"member.gender === 'female' && member.image === null\" src=\"../assets/avatar_female.png\">\n                              <img style=\"width:70px\" v-if=\"member.image !== null\" :src=\"member.image\"><br>\n                              <span style=\"font-weight: bold\">{{ member.name }}</span><br>\n                              <span v-if=\"member.birthday !== ''\">{{ member.age }} ans</span><br>\n                              <span class=\"birthday\" v-if=\"member.birthday !== ''\">\n                                <img src=\"../assets/cake_dark.png\" v-if=\"this.darkMode === true\" style=\"width:14px\"/> \n                                <img src=\"../assets/cake.png\" v-if=\"this.darkMode === false\" style=\"width:14px\"/>\n                                ({{ formatBirthday(member.birthday) }})\n                              </span>\n                          </div>\n                      </div>\n\n                      <!-- Single & Children -->\n                      <div v-else-if=\"group.type === 'single'\" class=\"single-box\">\n                            <div class=\"member_box\"\n                              :class=\"{ 'male-border': group.members[0].gender === 'male', 'female-border': group.members[0].gender === 'female', dark: darkMode }\"\n                              :ref=\"el => { if (el) allMemberBoxes[group.members[0].name] = el }\">\n                              <img style=\"width:70px\" v-if=\"group.members[0].gender === 'male' && group.members[0].image === null\" src=\"../assets/avatar_male.png\">\n                              <img style=\"width:70px\" v-if=\"group.members[0].gender === 'female' && group.members[0].image === null\" src=\"../assets/avatar_female.png\">\n                              <img style=\"width:70px\" v-if=\"group.members[0].image !== null\" :src=\"group.members[0].image\"><br>\n                              <span style=\"font-weight: bold\">{{ group.members[0].name }}</span><br>\n                              <span v-if=\"group.members[0].birthday !== ''\">{{ group.members[0].age }} ans</span><br>\n                              <span class=\"birthday\" v-if=\"group.members[0].birthday !== ''\">\n                                <img src=\"../assets/cake_dark.png\" v-if=\"this.darkMode === true\" style=\"width:14px\"/> \n                                <img src=\"../assets/cake.png\" v-if=\"this.darkMode === false\" style=\"width:14px\"/>\n                                ({{ formatBirthday(group.members[0].birthday) }})\n                              </span>\n                          </div>\n                      </div>\n                  </div>\n              </div>\n            </div>\n            <!-- SVG Overlay for all relationships -->\n            <svg class=\"relationship-overlay\" ref=\"svgContainer\"></svg>\n            </div>\n        </div>\n        <div v-else><p style=\"font-style: italic;\">Aucun membre n'est enregistr√©.</p></div>\n        <div v-if=\"showScreenshotOptions && members.length > 0\" class=\"modal-overlay\">\n            <div class=\"modal-content\">\n                <h3>Screenshot Options</h3>\n                <p>What would you like to do with the screenshot?</p>\n                <button @click=\"downloadScreenshot\">Download</button>\n                <button @click=\"showEmailInput = true\">Send by Email</button>\n                <button @click=\"showScreenshotOptions = false\">Cancel</button>\n\n                <div v-if=\"showEmailInput\" class=\"email-input-container\">\n                    <input type=\"email\" v-model=\"email\" placeholder=\"Enter your email\">\n                    <button @click=\"sendEmail\">Send</button>\n                </div>\n            </div>\n        </div>\n        <div class=\"camera-control\">\n            <button @click=\"openScreenshotOptions\"><img src=\"../assets/camera.png\"/></button>\n        </div>\n        <div class=\"filters-control\">\n          <button @click=\"toggleFiltersPanel\" v-if=\"!isFiltersPanelVisible\"><img src=\"../assets/filters.png\"/></button>\n        </div>\n        <div class=\"zoom-controls\" v-if=\"members.length > 0\">\n            <button @click=\"zoomIn\">+</button>\n            <button @click=\"zoomOut\">-</button>\n        </div>\n        <FiltersSidePanel :isFiltersPanelVisible=\"isFiltersPanelVisible\" @close-panel=\"closeFiltersPanel\" @gender-filter-changed=\"applyGenderFilter\" @relationship-filter-changed=\"applyRelationshipFilter\" />\n    </div>\n</template>\n\n<script>\nimport interact from 'interactjs';\nimport html2canvas from 'html2canvas';\nimport FiltersSidePanel from '../components/FiltersSidePanel.vue';\n\nexport default {\n  data() {\n    return {\n      processedGenerations: [],\n      allMemberBoxes: {},\n      zoomLevel: 1,\n      showScreenshotOptions: false,\n      showEmailInput: false,\n      email: '',\n      isFiltersPanelVisible: false,\n      selectedGender: '', // To store the filter value\n      selectedRelationship: '',\n      isPanning: false,\n      panStart: { x: 0, y: 0 },\n      treePosition: { x: 0, y: 0 },\n    };\n  },\n  computed: {\n    members() {\n      return this.$store.state.members;\n    },\n    filteredMembers() {\n      if (!this.selectedGender) {\n        return this.members;\n      }\n      return this.members.filter(member => member.gender === this.selectedGender);\n    },\n    darkMode() {\n      return this.$store.state.darkMode;\n    },\n    displayGenerations() {\n      if (!this.selectedRelationship) {\n        return this.processedGenerations;\n      }\n\n      const filteredGenerations = [];\n      for (const generation of this.processedGenerations) {\n        const filteredGroups = generation.filter(group => {\n          if (this.selectedRelationship === 'married') {\n            return group.type === 'couple';\n          }\n          return true;\n        });\n        if (filteredGroups.length > 0) {\n          filteredGenerations.push(filteredGroups);\n        }\n      }\n      return filteredGenerations;\n    }\n  },\n  components: {\n    FiltersSidePanel,\n  },\n  watch: {\n    members: {\n      handler: 'renderTree',\n      deep: true\n    },\n    zoomLevel() {\n      // Wait for the 0.3s zoom transition to finish before redrawing lines\n      setTimeout(() => {\n        this.drawRelationships();\n      }, 300);\n    }\n  },\n  mounted() {\n    window.addEventListener('resize', this.renderTree);\n    this.renderTree();\n    this.initInteract();\n  },\n    beforeUnmount() {\n    window.removeEventListener('resize', this.renderTree);\n  },\n  methods: {\n    startPan(event) {\n      if (event.target.closest('.draggable-group')) {\n        return;\n      }\n      this.isPanning = true;\n      this.panStart.x = event.clientX;\n      this.panStart.y = event.clientY;\n    },\n    pan(event) {\n      if (this.isPanning) {\n        const dx = event.clientX - this.panStart.x;\n        const dy = event.clientY - this.panStart.y;\n        this.treePosition.x += dx;\n        this.treePosition.y += dy;\n        this.panStart.x = event.clientX;\n        this.panStart.y = event.clientY;\n      }\n    },\n    endPan() {\n      this.isPanning = false;\n    },\n    toggleFiltersPanel() {\n      this.isFiltersPanelVisible = !this.isFiltersPanelVisible;\n    },\n    closeFiltersPanel() {\n      this.isFiltersPanelVisible = false;\n    },\n    applyGenderFilter(gender) {\n      this.selectedGender = gender;\n      this.renderTree(); // Re-render the tree with the new filter\n    },\n    applyRelationshipFilter(relationship) {\n      this.selectedRelationship = relationship;\n      this.renderTree(); // Re-render the tree with the new filter\n    },\n    openScreenshotOptions() {\n      this.showScreenshotOptions = true;\n      this.showEmailInput = false;\n      this.email = '';\n    },\n\n    downloadScreenshot() {\n      const captureTarget = this.$refs.treeWrapper;\n      if (!captureTarget) return;\n\n      html2canvas(captureTarget, {\n        useCORS: true,\n        allowTaint: true,\n        width: captureTarget.scrollWidth,\n        height: captureTarget.scrollHeight,\n        backgroundColor: 'white',\n      }).then(canvas => {\n        const link = document.createElement('a');\n        link.href = canvas.toDataURL('image/png');\n        link.download = 'family-tree.png';\n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n        this.showScreenshotOptions = false;\n      });\n    },\n\n    sendEmail() {\n      const captureTarget = this.$refs.treeWrapper;\n      if (!captureTarget) return;\n\n      if (!this.email) {\n        alert('Please enter an email address.');\n        return;\n      }\n\n      html2canvas(captureTarget, {\n        useCORS: true,\n        allowTaint: true,\n        width: captureTarget.scrollWidth,\n        height: captureTarget.scrollHeight,\n        backgroundColor: 'white',\n      }).then(canvas => {\n        const image = canvas.toDataURL('image/png');\n        \n        fetch('http://localhost:3000/send-email', {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n            },\n            body: JSON.stringify({ email: this.email, image: image }),\n        })\n        .then(response => response.text())\n        .then(data => {\n            alert(data);\n            this.showScreenshotOptions = false;\n        })\n        .catch(error => {\n            console.error('Error:', error);\n            alert('Error sending email. Make sure the backend server is running.');\n        });\n      });\n    },\n\n    renderTree() {\n        this.allMemberBoxes = {};\n        this.processMembers();\n        this.optimizeCoupleOrder();\n        this.$nextTick(() => {\n            this.drawRelationships();\n        });\n    },\n\n    initInteract() {\n      interact('.draggable-group').draggable({\n        inertia: true,\n        autoScroll: true,\n        listeners: {\n          move: this.dragMoveListener,\n          end: this.dragEndListener\n        }\n      });\n    },\n\n    dragMoveListener(event) {\n      const target = event.target;\n      const groupId = target.getAttribute('data-group-id');\n      \n      // Find the group in the processedGenerations data\n      let group = null;\n      for (const generation of this.processedGenerations) {\n        group = generation.find(g => g.id === groupId);\n        if (group) break;\n      }\n\n      if (group) {\n        // The drag event's dx/dy are scaled by the zoom, we need to un-scale them\n        const unscaledDx = event.dx / this.zoomLevel;\n        const unscaledDy = event.dy / this.zoomLevel;\n\n        const x = (group.x || 0) + unscaledDx;\n        const y = (group.y || 0) + unscaledDy;\n\n        group.x = x;\n        group.y = y;\n        \n        target.style.transform = `translate(${x}px, ${y}px)`;\n        target.setAttribute('data-x', x);\n        target.setAttribute('data-y', y);\n\n        this.drawRelationships();\n      }\n    },\n\n    dragEndListener(event) {\n        const target = event.target;\n        const groupId = target.getAttribute('data-group-id');\n        const x = parseFloat(target.getAttribute('data-x')) || 0;\n        const y = parseFloat(target.getAttribute('data-y')) || 0;\n        this.saveGroupPosition(groupId, x, y);\n    },\n\n    saveGroupPosition(groupId, x, y) {\n        localStorage.setItem(`group-pos-${groupId}`, JSON.stringify({ x, y }));\n    },\n\n    loadGroupPosition(groupId) {\n        const pos = localStorage.getItem(`group-pos-${groupId}`);\n        if (pos) {\n            return JSON.parse(pos);\n        }\n        return { x: 0, y: 0 };\n    },\n\n    optimizeCoupleOrder() {\n        this.processedGenerations.forEach(generation => {\n            for (let k = 0; k < generation.length; k++) {\n                for (let i = 0; i < generation.length - 1; i++) {\n                    const groupA = generation[i];\n                    const groupB = generation[i + 1];\n\n                    if (groupA.type === 'couple' && groupB.type === 'couple') {\n                        const [memberA1] = groupA.members;\n                        const [, memberB2] = groupB.members;\n\n                        const groupBMembers = new Set(groupB.members.map(m => m.name));\n                        const groupAMembers = new Set(groupA.members.map(m => m.name));\n\n                        if (memberA1.siblings && memberA1.siblings.some(s => groupBMembers.has(s))) {\n                            [groupA.members[0], groupA.members[1]] = [groupA.members[1], groupA.members[0]];\n                        }\n\n                        if (memberB2.siblings && memberB2.siblings.some(s => groupAMembers.has(s))) {\n                            [groupB.members[0], groupB.members[1]] = [groupB.members[1], groupB.members[0]];\n                        }\n                    }\n                }\n            }\n        });\n    },\n\n    processMembers() {\n        const members = this.filteredMembers;\n        if (members.length === 0) {\n            this.processedGenerations = [];\n            return;\n        }\n\n        const memberMap = new Map(members.map(m => [m.name, m]));\n        const generations = new Map();\n        const visited = new Set();\n\n        const roots = members.filter(m => !members.some(p => (p.children || []).includes(m.name)));\n\n        function assignGeneration(memberName, generation) {\n            if (visited.has(memberName) || !memberMap.has(memberName)) return;\n            visited.add(memberName);\n\n            if (!generations.has(generation)) {\n                generations.set(generation, new Set());\n            }\n            generations.get(generation).add(memberName);\n\n            const member = memberMap.get(memberName);\n            (member.children || []).forEach(childName => {\n                assignGeneration(childName, generation + 1);\n            });\n        }\n\n        roots.forEach(root => assignGeneration(root.name, 0));\n        \n        const finalGenerations = [];\n        const sortedGenerationKeys = [...generations.keys()].sort((a, b) => a - b);\n\n        sortedGenerationKeys.forEach(genKey => {\n            const generationMembers = [...generations.get(genKey)].map(name => memberMap.get(name));\n            const finalProcessed = [];\n            const processedNames = new Set();\n\n            const processGroup = (id, type, members) => {\n                const pos = this.loadGroupPosition(id);\n                finalProcessed.push({ id, type, members, ...pos });\n                members.forEach(m => processedNames.add(m.name));\n            };\n\n            if (this.selectedRelationship === 'siblings') {\n                generationMembers.forEach(member => {\n                    if (processedNames.has(member.name)) return;\n\n                    if (member.siblings && member.siblings.length > 0) {\n                        const siblingGroupMembers = [member, ...member.siblings.map(name => generationMembers.find(m => m.name === name)).filter(Boolean)];\n\n                        if (siblingGroupMembers.length > 1) {\n                            // Check if any member of this potential group has already been processed.\n                            const alreadyProcessed = siblingGroupMembers.some(m => processedNames.has(m.name));\n                            if (!alreadyProcessed) {\n                                const groupId = siblingGroupMembers.map(m => m.name).sort().join('-');\n                                processGroup(groupId, 'siblings', siblingGroupMembers);\n                            }\n                        }\n                    }\n                });\n            } else {\n                // Existing logic\n                generationMembers.forEach(member => {\n                    if (processedNames.has(member.name)) return;\n                    if (member.married) {\n                        const partner = generationMembers.find(m => m.name === member.married);\n                        if (partner && !processedNames.has(partner.name)) {\n                            const coupleMembers = [member, partner].sort((a, b) => b.age - a.age);\n                            processGroup(`${member.name}-${partner.name}`, 'couple', coupleMembers);\n                        }\n                    }\n                });\n\n                generationMembers.forEach(member => {\n                    if (processedNames.has(member.name)) return;\n                    if (member.siblings && member.siblings.length > 0) {\n                        const siblingGroup = [member, ...member.siblings.map(name => generationMembers.find(m => m.name === name)).filter(Boolean)];\n                        if (siblingGroup.length > 1 && siblingGroup.every(m => !processedNames.has(m.name))) {\n                            // Instead of grouping siblings, treat them as singles for individual dragging\n                            siblingGroup.forEach(sibling => {\n                                if (!processedNames.has(sibling.name)) {\n                                    processGroup(sibling.name, 'single', [sibling]);\n                                }\n                            });\n                        }\n                    }\n                });\n\n                generationMembers.forEach(member => {\n                    if (!processedNames.has(member.name)) {\n                        processGroup(member.name, 'single', [member]);\n                    }\n                });\n            }\n            finalGenerations.push(finalProcessed);\n        });\n\n        this.processedGenerations = finalGenerations;\n    },\n\n    drawRelationships() {\n        const svg = this.$refs.svgContainer;\n        const wrapper = this.$refs.transformContainer;\n        if (!svg || !wrapper) return;\n\n        svg.innerHTML = '';\n        wrapper.querySelectorAll('.html-heart').forEach(h => h.remove());\n\n        const wrapperRect = wrapper.getBoundingClientRect();\n\n        const drawnChildren = new Set();\n        const relationship = this.selectedRelationship;\n\n        if (relationship === '' || relationship === 'married') {\n            this.filteredMembers.forEach(member => {\n                if (member.married && member.name < member.married) {\n                    const partner = this.members.find(m => m.name === member.married);\n                    if (!partner) return;\n\n                    const memberBox = this.allMemberBoxes[member.name];\n                    const partnerBox = this.allMemberBoxes[partner.name];\n                    if (!memberBox || !partnerBox) return;\n\n                    this.drawHeart(wrapper, wrapperRect, memberBox, partnerBox);\n\n                    if (relationship === '') {\n                        const commonChildren = this.getCommonChildren(member, partner);\n                        commonChildren.forEach(childName => {\n                            const childBox = this.allMemberBoxes[childName];\n                            if (childBox) {\n                                const heartMidpoint = this.getHeartMidpoint(wrapperRect, memberBox, partnerBox);\n                                this.drawPathFromPoint(svg, wrapperRect, heartMidpoint, childBox, 'blue');\n                                drawnChildren.add(childName);\n                            }\n                        });\n                    }\n                }\n            });\n        }\n\n        if (relationship === '') {\n            this.filteredMembers.forEach(member => {\n                if (member.siblings) {\n                    member.siblings.forEach(siblingName => {\n                        if (member.name < siblingName) {\n                            const siblingBox = this.allMemberBoxes[siblingName];\n                            if (siblingBox) this.drawPath(svg, wrapperRect, this.allMemberBoxes[member.name], siblingBox, 'green');\n                        }\n                    });\n                }\n            });\n        }\n\n        if (relationship === '') {\n            this.filteredMembers.forEach(member => {\n                if (member.children) {\n                    member.children.forEach(childName => {\n                        if (!drawnChildren.has(childName)) {\n                            const childBox = this.allMemberBoxes[childName];\n                            if (childBox) this.drawPath(svg, wrapperRect, this.allMemberBoxes[member.name], childBox, 'blue');\n                        }\n                    });\n                }\n            });\n        }\n    },\n\n    getCommonChildren(member1, member2) {\n        const children1 = new Set(member1.children || []);\n        const children2 = new Set(member2.children || []);\n        return [...children1].filter(childName => children2.has(childName));\n    },\n\n    getBoxCenter(wrapperRect, box) {\n        if (!box) return { x: 0, y: 0 };\n        const boxRect = box.getBoundingClientRect();\n        const x = boxRect.left + boxRect.width / 2 - wrapperRect.left;\n        const y = boxRect.top + boxRect.height / 2 - wrapperRect.top;\n        return {\n            x: x / this.zoomLevel,\n            y: y / this.zoomLevel,\n        };\n    },\n\n    getHeartMidpoint(wrapperRect, box1, box2) {\n        const center1 = this.getBoxCenter(wrapperRect, box1);\n        const center2 = this.getBoxCenter(wrapperRect, box2);\n        return { x: (center1.x + center2.x) / 2, y: (center1.y + center2.y) / 2 };\n    },\n\n    drawALine(svg, p1, p2, color) {\n        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n        path.setAttribute('d', `M ${p1.x} ${p1.y} L ${p2.x} ${p2.y}`);\n        path.setAttribute('stroke', color);\n        path.setAttribute('stroke-width', '2');\n        path.setAttribute('fill', 'none');\n        svg.appendChild(path);\n    },\n\n    drawPathFromPoint(svg, wrapperRect, startPoint, endBox, color) {\n        const endPoint = this.getBoxCenter(wrapperRect, endBox);\n        this.drawALine(svg, startPoint, endPoint, color);\n    },\n\n    drawPath(svg, wrapperRect, box1, box2, color) {\n        const startPoint = this.getBoxCenter(wrapperRect, box1);\n        const endPoint = this.getBoxCenter(wrapperRect, box2);\n        this.drawALine(svg, startPoint, endPoint, color);\n    },\n\n    drawHeart(container, wrapperRect, box1, box2) {\n        const midPoint = this.getHeartMidpoint(wrapperRect, box1, box2);\n        const heart = document.createElement('img');\n        heart.src = require('../assets/red_heart.png');\n        heart.className = 'heart-icon html-heart';\n        heart.style.position = 'absolute';\n        heart.style.left = `${midPoint.x - 12.5}px`;\n        heart.style.top = `${midPoint.y - 12.5}px`;\n        container.appendChild(heart);\n    },\n\n    formatBirthday(birthday) {\n      if (!birthday) return null;\n      const date = new Date(birthday);\n      if (isNaN(date)) return null;\n      const day = String(date.getDate()).padStart(2, '0');\n      const month = String(date.getMonth() + 1).padStart(2, '0');\n      const year = date.getFullYear();\n      return `${day}/${month}/${year}`;\n    },\n\n    zoomIn() {\n      this.zoomLevel = Math.min(this.zoomLevel + 0.2, 3);\n    },\n\n    zoomOut() {\n      this.zoomLevel = Math.max(this.zoomLevel - 0.2, 0.2);\n    }\n  }\n}\n</script>\n\n<style>\n.tree-wrapper {\n    position: relative;\n    width: 100%;\n    cursor: grab;\n}\n\n.tree-wrapper.panning {\n    cursor: grabbing;\n}\n\n.transform-container {\n    transition: transform 0.3s ease-in-out;\n    position: relative;\n}\n\n.all_the_members {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 40px;\n    padding: 20px;\n    position: relative;\n    z-index: 1;\n}\n\n.generation {\n    display: flex;\n    justify-content: center;\n    align-items: flex-start; /* Align groups to the top */\n    gap: 20px;\n    width: 100%;\n}\n\n.member-group {\n    cursor: grab;\n    position: relative; /* Needed for interact.js to work with transforms */\n}\n\n.member-group:active {\n    cursor: grabbing;\n    z-index: 10; /* Bring to front while dragging */\n}\n\n.sibling-box {\n    display: flex;\n    gap: 20px;\n    justify-content: center;\n    flex-wrap: wrap;\n    border: 1px solid green;\n    background-color: rgba(144, 238, 144, 0.3);\n    padding: 15px;\n    border-radius: 10px;\n}\n\n.single-box {\n    display: flex;\n    gap: 20px;\n    justify-content: center;\n    flex-wrap: wrap;\n}\n\n.couple-box.highlight-married {\n    background-color: rgba(255, 99, 71, 0.3); /* Tomato with opacity */\n}\n\n.couple-box {\n    display: flex;\n    gap: 50px;\n    justify-content: center;\n    flex-wrap: wrap;\n    border: 1px solid #ccc;\n    padding: 15px;\n    border-radius: 10px;\n    background-color: rgba(230, 230, 230, 0.5);\n}\n\n.relationship-overlay {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    pointer-events: none;\n    z-index: 0;\n}\n\n@keyframes pulse {\n    0% { transform: scale(1); }\n    50% { transform: scale(1.3); }\n    100% { transform: scale(1); }\n}\n\n.heart-icon {\n    animation: pulse 1.5s infinite;\n}\n\n.html-heart {\n    width: 25px;\n    height: 25px;\n    z-index: 0; /* Keep it behind member boxes */\n    pointer-events: none; /* Make it non-interactive */\n}\n\n.member_box {\n    border: solid 1px black;\n    width: 95px;\n    padding: 5px;\n    box-shadow: 2px 5px 5px black;\n    background-color: #fdfdfd;\n    text-align: center;\n}\n\n.member_box.dark {\n  background-color:black;\n}\n\n.member_box.male-border {\n    border: 2px solid var(--blue);\n}\n\n.member_box.female-border {\n    border: 2px solid var(--pink);\n}\n\n.member_box:hover {\n    background-color: var(--lightGrey);\n}\n\nspan.birthday {\n  font-size:13px;\n}\n\n.camera-control {\n  position: fixed;\n  top: 50px; \n  left:20px;\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  z-index: 10;\n}\n\n.camera-control button {\n  width: 40px;\n  height: 40px;\n  border: none;\n  border-radius: 6px;\n  background-color: #333;\n  color: white;\n  font-size: 20px;\n  cursor: pointer;\n}\n\n.camera-control button:hover {\n  background-color: #555;\n}\n\n.filters-control {\n  position: fixed;\n  top: 50px;\n  right: 20px;\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  z-index: 10;\n}\n\n.filters-control button {\n  width: 40px;\n  height: 40px;\n  border: none;\n  border-radius: 6px;\n  background-color: #333;\n  color: white;\n  font-size: 20px;\n  cursor: pointer;\n}\n\n.filters-control button:hover {\n background-color: #555;\n}\n\n.zoom-controls {\n  position: fixed;\n  bottom: 50px;\n  left: 20px;\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  z-index: 10;\n}\n\n.zoom-controls button {\n  width: 40px;\n  height: 40px;\n  border: none;\n  border-radius: 6px;\n  background-color: #333;\n  color: white;\n  font-size: 20px;\n  cursor: pointer;\n}\n\n.zoom-controls button:hover {\n background-color: #555;\n}\n\n.modal-overlay {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0.5);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 100;\n}\n\n.modal-content {\n  background-color: white;\n  padding: 20px;\n  border-radius: 8px;\n  text-align: center;\n}\n\n.modal-content h3 {\n  margin-top: 0;\n}\n\n.modal-content button {\n  margin: 5px;\n}\n\n.email-input-container {\n  margin-top: 15px;\n}\n\n.email-input-container input {\n  padding: 8px;\n  border: 1px solid #ccc;\n  border-radius: 4px;\n  margin-right: 10px;\n}\n\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}