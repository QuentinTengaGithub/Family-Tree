{"ast":null,"code":"import { getAuth, updatePassword, updateEmail, EmailAuthProvider, reauthenticateWithCredential } from \"firebase/auth\";\nimport { doc, updateDoc } from \"firebase/firestore\";\nimport { db } from \"../firebaseConfig\";\nexport default {\n  name: 'ProfileView',\n  data() {\n    return {\n      name: '',\n      email: '',\n      editMode: {\n        name: false,\n        email: false,\n        password: false\n      },\n      form: {\n        name: '',\n        email: '',\n        password: '',\n        confirmPassword: ''\n      }\n    };\n  },\n  computed: {\n    user() {\n      return this.$store.state.user;\n    }\n  },\n  methods: {\n    fetchUserData() {\n      if (this.user) {\n        this.name = this.user.name;\n        this.email = this.user.email;\n      }\n    },\n    startEdit(field) {\n      this.editMode[field] = true;\n      // Pre-fill form with current data\n      this.form.name = this.name;\n      this.form.email = this.email;\n      this.form.password = '';\n      this.form.confirmPassword = '';\n    },\n    cancelEdit(field) {\n      this.editMode[field] = false;\n    },\n    async reauthenticate() {\n      const currentPassword = prompt(\"To save changes, please enter your current password:\");\n      if (!currentPassword) {\n        return false;\n      }\n      const auth = getAuth();\n      const credential = EmailAuthProvider.credential(this.user.email, currentPassword);\n      try {\n        await reauthenticateWithCredential(auth.currentUser, credential);\n        return true;\n      } catch (error) {\n        alert(`Authentication failed. Please check your password. Error: ${error.message}`);\n        return false;\n      }\n    },\n    async updateName() {\n      if (!this.form.name || this.form.name === this.name) {\n        alert(\"No new name entered.\");\n        this.editMode.name = false;\n        return;\n      }\n      const userDocRef = doc(db, \"users\", this.user.uid);\n      try {\n        await updateDoc(userDocRef, {\n          name: this.form.name\n        });\n        this.name = this.form.name;\n        this.$store.commit('setUser', {\n          ...this.user,\n          name: this.form.name\n        });\n        alert(\"Name updated successfully!\");\n        this.editMode.name = false;\n      } catch (error) {\n        alert(`Failed to update name. Error: ${error.message}`);\n      }\n    },\n    async updateUserEmail() {\n      if (!this.form.email || this.form.email === this.email) {\n        alert(\"No new email entered.\");\n        this.editMode.email = false;\n        return;\n      }\n      const isAuthenticated = await this.reauthenticate();\n      if (!isAuthenticated) return;\n      const auth = getAuth();\n      try {\n        // Update auth first\n        await updateEmail(auth.currentUser, this.form.email);\n\n        // Then update Firestore\n        const userDocRef = doc(db, \"users\", this.user.uid);\n        await updateDoc(userDocRef, {\n          email: this.form.email\n        });\n        this.email = this.form.email;\n        this.$store.commit('setUser', {\n          ...this.user,\n          email: this.form.email\n        });\n        alert(\"Email updated successfully!\");\n        this.editMode.email = false;\n      } catch (error) {\n        alert(`Failed to update email. Error: ${error.message}`);\n      }\n    },\n    async updateUserPassword() {\n      if (!this.form.password || !this.form.confirmPassword) {\n        alert(\"Please fill in both password fields.\");\n        return;\n      }\n      if (this.form.password !== this.form.confirmPassword) {\n        alert(\"New passwords do not match.\");\n        return;\n      }\n      const isAuthenticated = await this.reauthenticate();\n      if (!isAuthenticated) return;\n      const auth = getAuth();\n      try {\n        await updatePassword(auth.currentUser, this.form.password);\n        alert(\"Password updated successfully!\");\n        this.editMode.password = false;\n      } catch (error) {\n        alert(`Failed to update password. Error: ${error.message}`);\n      }\n    }\n  },\n  created() {\n    this.fetchUserData();\n  },\n  watch: {\n    user(newUser) {\n      if (newUser) {\n        this.name = newUser.name;\n        this.email = newUser.email;\n      } else {\n        // Handle logout: clear fields or redirect\n        this.name = '';\n        this.email = '';\n      }\n    }\n  }\n};","map":{"version":3,"names":["getAuth","updatePassword","updateEmail","EmailAuthProvider","reauthenticateWithCredential","doc","updateDoc","db","name","data","email","editMode","password","form","confirmPassword","computed","user","$store","state","methods","fetchUserData","startEdit","field","cancelEdit","reauthenticate","currentPassword","prompt","auth","credential","currentUser","error","alert","message","updateName","userDocRef","uid","commit","updateUserEmail","isAuthenticated","updateUserPassword","created","watch","newUser"],"sources":["/Users/quentin/Family-Tree/src/views/ProfileView.vue"],"sourcesContent":["<template>\n  <div class=\"content\">\n    <h1>My Profile</h1>\n\n    <!-- Name Section -->\n    <div class=\"profile-section\">\n      <h2>Name</h2>\n      <div v-if=\"!editMode.name\">\n        <p>{{ name }}</p>\n        <button class=\"button\" @click=\"startEdit('name')\">Edit Name</button>\n      </div>\n      <div v-else>\n        <div class=\"form_input_container\">\n          <input type=\"text\" v-model=\"form.name\" class=\"form_input\" />\n        </div>\n        <button class=\"button\" @click=\"updateName\">Save</button>\n        <button class=\"button-secondary\" @click=\"cancelEdit('name')\">Cancel</button>\n      </div>\n    </div>\n\n    <!-- Email Section -->\n    <div class=\"profile-section\">\n      <h2>Email</h2>\n      <div v-if=\"!editMode.email\">\n        <p>{{ email }}</p>\n        <button class=\"button\" @click=\"startEdit('email')\">Edit Email</button>\n      </div>\n      <div v-else>\n        <div class=\"form_input_container\">\n          <input type=\"email\" v-model=\"form.email\" class=\"form_input\" />\n        </div>\n        <button class=\"button\" @click=\"updateUserEmail\">Save</button>\n        <button class=\"button-secondary\" @click=\"cancelEdit('email')\">Cancel</button>\n      </div>\n    </div>\n\n    <!-- Password Section -->\n    <div class=\"profile-section\">\n      <h2>Password</h2>\n      <div v-if=\"!editMode.password\">\n        <p>********</p>\n        <button class=\"button\" @click=\"startEdit('password')\">Change Password</button>\n      </div>\n      <div v-else>\n        <div class=\"form_input_container\">\n          <p class=\"form_text\">New Password</p>\n          <input type=\"password\" v-model=\"form.password\" class=\"form_input\" />\n        </div>\n        <div class=\"form_input_container\">\n          <p class=\"form_text\">Confirm New Password</p>\n          <input type=\"password\" v-model=\"form.confirmPassword\" class=\"form_input\" />\n        </div>\n        <button class=\"button\" @click=\"updateUserPassword\">Save New Password</button>\n        <button class=\"button-secondary\" @click=\"cancelEdit('password')\">Cancel</button>\n      </div>\n    </div>\n\n  </div>\n</template>\n\n<script>\nimport { getAuth, updatePassword, updateEmail, EmailAuthProvider, reauthenticateWithCredential } from \"firebase/auth\";\nimport { doc, updateDoc } from \"firebase/firestore\";\nimport { db } from \"../firebaseConfig\";\n\nexport default {\n  name: 'ProfileView',\n  data() {\n    return {\n      name: '',\n      email: '',\n      editMode: {\n        name: false,\n        email: false,\n        password: false,\n      },\n      form: {\n        name: '',\n        email: '',\n        password: '',\n        confirmPassword: '',\n      }\n    };\n  },\n  computed: {\n    user() {\n      return this.$store.state.user;\n    }\n  },\n  methods: {\n    fetchUserData() {\n      if (this.user) {\n        this.name = this.user.name;\n        this.email = this.user.email;\n      }\n    },\n    startEdit(field) {\n      this.editMode[field] = true;\n      // Pre-fill form with current data\n      this.form.name = this.name;\n      this.form.email = this.email;\n      this.form.password = '';\n      this.form.confirmPassword = '';\n    },\n    cancelEdit(field) {\n      this.editMode[field] = false;\n    },\n    async reauthenticate() {\n      const currentPassword = prompt(\"To save changes, please enter your current password:\");\n      if (!currentPassword) {\n        return false;\n      }\n      const auth = getAuth();\n      const credential = EmailAuthProvider.credential(this.user.email, currentPassword);\n      try {\n        await reauthenticateWithCredential(auth.currentUser, credential);\n        return true;\n      } catch (error) {\n        alert(`Authentication failed. Please check your password. Error: ${error.message}`);\n        return false;\n      }\n    },\n    async updateName() {\n      if (!this.form.name || this.form.name === this.name) {\n        alert(\"No new name entered.\");\n        this.editMode.name = false;\n        return;\n      }\n      \n      const userDocRef = doc(db, \"users\", this.user.uid);\n      try {\n        await updateDoc(userDocRef, { name: this.form.name });\n        this.name = this.form.name;\n        this.$store.commit('setUser', { ...this.user, name: this.form.name });\n        alert(\"Name updated successfully!\");\n        this.editMode.name = false;\n      } catch (error) {\n        alert(`Failed to update name. Error: ${error.message}`);\n      }\n    },\n    async updateUserEmail() {\n       if (!this.form.email || this.form.email === this.email) {\n        alert(\"No new email entered.\");\n        this.editMode.email = false;\n        return;\n      }\n      \n      const isAuthenticated = await this.reauthenticate();\n      if (!isAuthenticated) return;\n\n      const auth = getAuth();\n      try {\n        // Update auth first\n        await updateEmail(auth.currentUser, this.form.email);\n        \n        // Then update Firestore\n        const userDocRef = doc(db, \"users\", this.user.uid);\n        await updateDoc(userDocRef, { email: this.form.email });\n\n        this.email = this.form.email;\n        this.$store.commit('setUser', { ...this.user, email: this.form.email });\n        alert(\"Email updated successfully!\");\n        this.editMode.email = false;\n      } catch (error) {\n        alert(`Failed to update email. Error: ${error.message}`);\n      }\n    },\n    async updateUserPassword() {\n      if (!this.form.password || !this.form.confirmPassword) {\n        alert(\"Please fill in both password fields.\");\n        return;\n      }\n      if (this.form.password !== this.form.confirmPassword) {\n        alert(\"New passwords do not match.\");\n        return;\n      }\n\n      const isAuthenticated = await this.reauthenticate();\n      if (!isAuthenticated) return;\n\n      const auth = getAuth();\n      try {\n        await updatePassword(auth.currentUser, this.form.password);\n        alert(\"Password updated successfully!\");\n        this.editMode.password = false;\n      } catch (error) {\n        alert(`Failed to update password. Error: ${error.message}`);\n      }\n    }\n  },\n  created() {\n    this.fetchUserData();\n  },\n  watch: {\n    user(newUser) {\n      if (newUser) {\n        this.name = newUser.name;\n        this.email = newUser.email;\n      } else {\n        // Handle logout: clear fields or redirect\n        this.name = '';\n        this.email = '';\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n.profile-section {\n  border-bottom: 1px solid #ccc;\n  padding: 20px 0;\n}\n.profile-section h2 {\n  margin-top: 0;\n}\n.form_input_container {\n  margin-bottom: 15px;\n}\n.button-secondary {\n    background-color: #6c757d;\n    color: white;\n    padding: 10px 15px;\n    border: none;\n    border-radius: 5px;\n    cursor: pointer;\n    margin-left: 10px;\n}\n.button-secondary:hover {\n    background-color: #5a6268;\n}\n</style>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}