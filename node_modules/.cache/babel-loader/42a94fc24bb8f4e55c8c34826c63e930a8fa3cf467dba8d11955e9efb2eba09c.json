{"ast":null,"code":"import { createElementVNode as _createElementVNode, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, openBlock as _openBlock, createElementBlock as _createElementBlock, vModelText as _vModelText, withDirectives as _withDirectives, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-59f8aca4\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  class: \"content\"\n};\nconst _hoisted_2 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"h1\", null, \"My Profile\", -1 /* HOISTED */));\nconst _hoisted_3 = {\n  class: \"profile-section\"\n};\nconst _hoisted_4 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"h2\", null, \"Name\", -1 /* HOISTED */));\nconst _hoisted_5 = {\n  key: 0\n};\nconst _hoisted_6 = {\n  key: 1\n};\nconst _hoisted_7 = {\n  class: \"form_input_container\"\n};\nconst _hoisted_8 = {\n  class: \"profile-section\"\n};\nconst _hoisted_9 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"h2\", null, \"Email\", -1 /* HOISTED */));\nconst _hoisted_10 = {\n  key: 0\n};\nconst _hoisted_11 = {\n  key: 1\n};\nconst _hoisted_12 = {\n  class: \"form_input_container\"\n};\nconst _hoisted_13 = {\n  class: \"profile-section\"\n};\nconst _hoisted_14 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"h2\", null, \"Password\", -1 /* HOISTED */));\nconst _hoisted_15 = {\n  key: 0\n};\nconst _hoisted_16 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"p\", null, \"********\", -1 /* HOISTED */));\nconst _hoisted_17 = {\n  key: 1\n};\nconst _hoisted_18 = {\n  class: \"form_input_container\"\n};\nconst _hoisted_19 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"p\", {\n  class: \"form_text\"\n}, \"New Password\", -1 /* HOISTED */));\nconst _hoisted_20 = {\n  class: \"form_input_container\"\n};\nconst _hoisted_21 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"p\", {\n  class: \"form_text\"\n}, \"Confirm New Password\", -1 /* HOISTED */));\n\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_hoisted_2, _createCommentVNode(\" Name Section \"), _createElementVNode(\"div\", _hoisted_3, [_hoisted_4, !$data.editMode.name ? (_openBlock(), _createElementBlock(\"div\", _hoisted_5, [_createElementVNode(\"p\", null, _toDisplayString($data.name), 1 /* TEXT */), _createElementVNode(\"button\", {\n    class: \"button\",\n    onClick: _cache[0] || (_cache[0] = $event => $options.startEdit('name'))\n  }, \"Edit Name\")])) : (_openBlock(), _createElementBlock(\"div\", _hoisted_6, [_createElementVNode(\"div\", _hoisted_7, [_withDirectives(_createElementVNode(\"input\", {\n    type: \"text\",\n    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $data.form.name = $event),\n    class: \"form_input\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $data.form.name]])]), _createElementVNode(\"button\", {\n    class: \"button\",\n    onClick: _cache[2] || (_cache[2] = (...args) => $options.updateName && $options.updateName(...args))\n  }, \"Save\"), _createElementVNode(\"button\", {\n    class: \"button-secondary\",\n    onClick: _cache[3] || (_cache[3] = $event => $options.cancelEdit('name'))\n  }, \"Cancel\")]))]), _createCommentVNode(\" Email Section \"), _createElementVNode(\"div\", _hoisted_8, [_hoisted_9, !$data.editMode.email ? (_openBlock(), _createElementBlock(\"div\", _hoisted_10, [_createElementVNode(\"p\", null, _toDisplayString($data.email), 1 /* TEXT */), _createElementVNode(\"button\", {\n    class: \"button\",\n    onClick: _cache[4] || (_cache[4] = $event => $options.startEdit('email'))\n  }, \"Edit Email\")])) : (_openBlock(), _createElementBlock(\"div\", _hoisted_11, [_createElementVNode(\"div\", _hoisted_12, [_withDirectives(_createElementVNode(\"input\", {\n    type: \"email\",\n    \"onUpdate:modelValue\": _cache[5] || (_cache[5] = $event => $data.form.email = $event),\n    class: \"form_input\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $data.form.email]])]), _createElementVNode(\"button\", {\n    class: \"button\",\n    onClick: _cache[6] || (_cache[6] = (...args) => $options.updateUserEmail && $options.updateUserEmail(...args))\n  }, \"Save\"), _createElementVNode(\"button\", {\n    class: \"button-secondary\",\n    onClick: _cache[7] || (_cache[7] = $event => $options.cancelEdit('email'))\n  }, \"Cancel\")]))]), _createCommentVNode(\" Password Section \"), _createElementVNode(\"div\", _hoisted_13, [_hoisted_14, !$data.editMode.password ? (_openBlock(), _createElementBlock(\"div\", _hoisted_15, [_hoisted_16, _createElementVNode(\"button\", {\n    class: \"button\",\n    onClick: _cache[8] || (_cache[8] = $event => $options.startEdit('password'))\n  }, \"Change Password\")])) : (_openBlock(), _createElementBlock(\"div\", _hoisted_17, [_createElementVNode(\"div\", _hoisted_18, [_hoisted_19, _withDirectives(_createElementVNode(\"input\", {\n    type: \"password\",\n    \"onUpdate:modelValue\": _cache[9] || (_cache[9] = $event => $data.form.password = $event),\n    class: \"form_input\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $data.form.password]])]), _createElementVNode(\"div\", _hoisted_20, [_hoisted_21, _withDirectives(_createElementVNode(\"input\", {\n    type: \"password\",\n    \"onUpdate:modelValue\": _cache[10] || (_cache[10] = $event => $data.form.confirmPassword = $event),\n    class: \"form_input\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $data.form.confirmPassword]])]), _createElementVNode(\"button\", {\n    class: \"button\",\n    onClick: _cache[11] || (_cache[11] = (...args) => $options.updateUserPassword && $options.updateUserPassword(...args))\n  }, \"Save New Password\"), _createElementVNode(\"button\", {\n    class: \"button-secondary\",\n    onClick: _cache[12] || (_cache[12] = $event => $options.cancelEdit('password'))\n  }, \"Cancel\")]))])]);\n}","map":{"version":3,"names":["class","_createElementVNode","_createElementBlock","_hoisted_1","_hoisted_2","_createCommentVNode","_hoisted_3","_hoisted_4","$data","editMode","name","_hoisted_5","_toDisplayString","onClick","_cache","$event","$options","startEdit","_hoisted_6","_hoisted_7","type","form","args","updateName","cancelEdit","_hoisted_8","_hoisted_9","email","_hoisted_10","_hoisted_11","_hoisted_12","updateUserEmail","_hoisted_13","_hoisted_14","password","_hoisted_15","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","confirmPassword","updateUserPassword"],"sources":["/Users/quentin/Family-Tree/src/views/ProfileView.vue"],"sourcesContent":["<template>\n  <div class=\"content\">\n    <h1>My Profile</h1>\n\n    <!-- Name Section -->\n    <div class=\"profile-section\">\n      <h2>Name</h2>\n      <div v-if=\"!editMode.name\">\n        <p>{{ name }}</p>\n        <button class=\"button\" @click=\"startEdit('name')\">Edit Name</button>\n      </div>\n      <div v-else>\n        <div class=\"form_input_container\">\n          <input type=\"text\" v-model=\"form.name\" class=\"form_input\" />\n        </div>\n        <button class=\"button\" @click=\"updateName\">Save</button>\n        <button class=\"button-secondary\" @click=\"cancelEdit('name')\">Cancel</button>\n      </div>\n    </div>\n\n    <!-- Email Section -->\n    <div class=\"profile-section\">\n      <h2>Email</h2>\n      <div v-if=\"!editMode.email\">\n        <p>{{ email }}</p>\n        <button class=\"button\" @click=\"startEdit('email')\">Edit Email</button>\n      </div>\n      <div v-else>\n        <div class=\"form_input_container\">\n          <input type=\"email\" v-model=\"form.email\" class=\"form_input\" />\n        </div>\n        <button class=\"button\" @click=\"updateUserEmail\">Save</button>\n        <button class=\"button-secondary\" @click=\"cancelEdit('email')\">Cancel</button>\n      </div>\n    </div>\n\n    <!-- Password Section -->\n    <div class=\"profile-section\">\n      <h2>Password</h2>\n      <div v-if=\"!editMode.password\">\n        <p>********</p>\n        <button class=\"button\" @click=\"startEdit('password')\">Change Password</button>\n      </div>\n      <div v-else>\n        <div class=\"form_input_container\">\n          <p class=\"form_text\">New Password</p>\n          <input type=\"password\" v-model=\"form.password\" class=\"form_input\" />\n        </div>\n        <div class=\"form_input_container\">\n          <p class=\"form_text\">Confirm New Password</p>\n          <input type=\"password\" v-model=\"form.confirmPassword\" class=\"form_input\" />\n        </div>\n        <button class=\"button\" @click=\"updateUserPassword\">Save New Password</button>\n        <button class=\"button-secondary\" @click=\"cancelEdit('password')\">Cancel</button>\n      </div>\n    </div>\n\n  </div>\n</template>\n\n<script>\nimport { getAuth, updatePassword, updateEmail, EmailAuthProvider, reauthenticateWithCredential } from \"firebase/auth\";\nimport { doc, updateDoc } from \"firebase/firestore\";\nimport { db } from \"../firebaseConfig\";\n\nexport default {\n  name: 'ProfileView',\n  data() {\n    return {\n      name: '',\n      email: '',\n      editMode: {\n        name: false,\n        email: false,\n        password: false,\n      },\n      form: {\n        name: '',\n        email: '',\n        password: '',\n        confirmPassword: '',\n      }\n    };\n  },\n  computed: {\n    user() {\n      return this.$store.state.user;\n    }\n  },\n  methods: {\n    fetchUserData() {\n      if (this.user) {\n        this.name = this.user.name;\n        this.email = this.user.email;\n      }\n    },\n    startEdit(field) {\n      this.editMode[field] = true;\n      // Pre-fill form with current data\n      this.form.name = this.name;\n      this.form.email = this.email;\n      this.form.password = '';\n      this.form.confirmPassword = '';\n    },\n    cancelEdit(field) {\n      this.editMode[field] = false;\n    },\n    async reauthenticate() {\n      const currentPassword = prompt(\"To save changes, please enter your current password:\");\n      if (!currentPassword) {\n        return false;\n      }\n      const auth = getAuth();\n      const credential = EmailAuthProvider.credential(this.user.email, currentPassword);\n      try {\n        await reauthenticateWithCredential(auth.currentUser, credential);\n        return true;\n      } catch (error) {\n        alert(`Authentication failed. Please check your password. Error: ${error.message}`);\n        return false;\n      }\n    },\n    async updateName() {\n      if (!this.form.name || this.form.name === this.name) {\n        alert(\"No new name entered.\");\n        this.editMode.name = false;\n        return;\n      }\n      \n      const userDocRef = doc(db, \"users\", this.user.uid);\n      try {\n        await updateDoc(userDocRef, { name: this.form.name });\n        this.name = this.form.name;\n        this.$store.commit('setUser', { ...this.user, name: this.form.name });\n        alert(\"Name updated successfully!\");\n        this.editMode.name = false;\n      } catch (error) {\n        alert(`Failed to update name. Error: ${error.message}`);\n      }\n    },\n    async updateUserEmail() {\n       if (!this.form.email || this.form.email === this.email) {\n        alert(\"No new email entered.\");\n        this.editMode.email = false;\n        return;\n      }\n      \n      const isAuthenticated = await this.reauthenticate();\n      if (!isAuthenticated) return;\n\n      const auth = getAuth();\n      try {\n        // Update auth first\n        await updateEmail(auth.currentUser, this.form.email);\n        \n        // Then update Firestore\n        const userDocRef = doc(db, \"users\", this.user.uid);\n        await updateDoc(userDocRef, { email: this.form.email });\n\n        this.email = this.form.email;\n        this.$store.commit('setUser', { ...this.user, email: this.form.email });\n        alert(\"Email updated successfully!\");\n        this.editMode.email = false;\n      } catch (error) {\n        alert(`Failed to update email. Error: ${error.message}`);\n      }\n    },\n    async updateUserPassword() {\n      if (!this.form.password || !this.form.confirmPassword) {\n        alert(\"Please fill in both password fields.\");\n        return;\n      }\n      if (this.form.password !== this.form.confirmPassword) {\n        alert(\"New passwords do not match.\");\n        return;\n      }\n\n      const isAuthenticated = await this.reauthenticate();\n      if (!isAuthenticated) return;\n\n      const auth = getAuth();\n      try {\n        await updatePassword(auth.currentUser, this.form.password);\n        alert(\"Password updated successfully!\");\n        this.editMode.password = false;\n      } catch (error) {\n        alert(`Failed to update password. Error: ${error.message}`);\n      }\n    }\n  },\n  created() {\n    this.fetchUserData();\n  },\n  watch: {\n    user(newUser) {\n      if (newUser) {\n        this.name = newUser.name;\n        this.email = newUser.email;\n      } else {\n        // Handle logout: clear fields or redirect\n        this.name = '';\n        this.email = '';\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n.content {\n  margin-top:0;\n}\n.profile-section {\n  border-bottom: 1px solid #ccc;\n  padding: 20px 0;\n}\n.profile-section h2 {\n  margin-top: 0;\n}\n.form_input_container {\n  margin-bottom: 15px;\n}\n.button-secondary {\n    background-color: #6c757d;\n    color: white;\n    padding: 10px 15px;\n    border: none;\n    border-radius: 5px;\n    cursor: pointer;\n    margin-left: 10px;\n}\n.button-secondary:hover {\n    background-color: #5a6268;\n}\n</style>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}